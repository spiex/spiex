<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Tabelka LM 2019/2020</title>
    <link rel="stylesheet" href="./scss/style.min.css">
  </head>
  <body>
    <header>
      <nav>
        <ul>
          <li><a href="index.html">TABELKA</a></li>
          <li><a href="spiex.html">typowanie</a></li>
          <li><a href="wyniki.html">wyniki</a></li>
          <li><a href="#" class="selected">punktacja</a></li>
        </ul>
      </nav>
    </header>

    <div class="jumbo">
      <div class="foto-box">
        <img src="https://www.thesportsdb.com/images/media/league/badge/dtp1dl1534767233.png">
      </div>
      <div class="title-box">
        <div>
          <h1>Tabelka LM</h1>
          <p>punktacja</p>
        </div>
      </div>
    </div>

    <div class="pojemnik-punktacja">
      <div class="button-box-wide">
        <button class="btn-secondary active" id="punktacja-1">NORMALNA</button>
        <button class="btn-secondary" id="punktacja-2">HANDICAP 1</button>
        <button class="btn-secondary" id="punktacja-3">HANDICAP 2</button>
      </div>
      <div id="boksNaTypy"></div>
    </div>

    <footer>
      <p>copyright by śpiex, <script>document.write(new Date().getFullYear())</script></p>
      <p>marcin.spiewakowski@gmail.com</p>
    </footer>

  <script src="script/punktacja.js"></script>
  <script>
     function makeApiCall() {
       var params = {
         spreadsheetId: '1cK-0glAn4xyDOE1CQLhzy0Mx_8l0wFH-KW06rTKLg_E',
         range: "points",
       };

      // custom functions
      function print(message, location) {
        let div = document.querySelector(location);
        div.innerHTML = message;
      }

      const button1 = document.querySelector("#punktacja-1");
      const button2 = document.querySelector("#punktacja-2");
      const button3 = document.querySelector("#punktacja-3");

      function printPoints(array) {
        let typy = [];
        typy +=
        `<div class="punktacja-legenda">
          <p>wynik</p>
          <div>
            <p>1x2</p>
            <p>różnica</p>
            <p>dokładny</p>
          </div>
        </div>`;

        let identifier = 0;
        let buttons = [button1, button2, button3];
        for (g = 0; g < buttons.length; g++) {
          if (buttons[g].classList.contains('active')) {
            identifier += [g]*3;
          };
        }

        for (i=0; i < array.length; i++) {
          // console.log(array[i][0]);
          typy +=
          `<div class="punktacja">
            <p class="przykladowy-wynik">${array[i][0]}</p>
            <div>
              <p>${array[i][1+identifier]}</p>
              <p>${array[i][2+identifier]}</p>
              <p>${array[i][3+identifier]}</p>
            </div>
          </div>`;
        }
        print(typy,"#boksNaTypy");
      }

      var request = gapi.client.sheets.spreadsheets.values.get(params);
        request.then(function(response) {
          console.log(response.result);
          printPoints(response.result.values);
        }, function(reason) {
          console.error('error: ' + reason.result.error.message);
        });

      button1.addEventListener('click',()=>{
        button1.classList.add('active');
        button2.classList.remove('active');
        button3.classList.remove('active');
        var request = gapi.client.sheets.spreadsheets.values.get(params);
          request.then(function(response) {
            console.log(response.result);
            printPoints(response.result.values);
          }, function(reason) {
            console.error('error: ' + reason.result.error.message);
          });
      });

      button2.addEventListener('click',()=>{
        button2.classList.add('active');
        button1.classList.remove('active');
        button3.classList.remove('active');
        var request = gapi.client.sheets.spreadsheets.values.get(params);
          request.then(function(response) {
            console.log(response.result);
            printPoints(response.result.values);
          }, function(reason) {
            console.error('error: ' + reason.result.error.message);
          });
      });

      button3.addEventListener('click',()=>{
        button3.classList.add('active');
        button2.classList.remove('active');
        button1.classList.remove('active');
        var request = gapi.client.sheets.spreadsheets.values.get(params);
          request.then(function(response) {
            console.log(response.result);
            printPoints(response.result.values);
          }, function(reason) {
            console.error('error: ' + reason.result.error.message);
          });
      });


     }


     function initClient() {
       var API_KEY = 'AIzaSyDteHMNEiCdA0XHbEPUM3plvjQzRw-rVVU';
       var CLIENT_ID = '896208609852-0d4hqobmliea0uq34uoho0lekhs2tch4.apps.googleusercontent.com';
       var SCOPE = 'https://www.googleapis.com/auth/spreadsheets.readonly';

       gapi.client.init({
         'apiKey': API_KEY,
         'clientId': CLIENT_ID,
         'scope': SCOPE,
         'discoveryDocs': ['https://sheets.googleapis.com/$discovery/rest?version=v4'],
       }).then(function() {
         gapi.auth2.getAuthInstance().isSignedIn.listen(updateSignInStatus);
         updateSignInStatus(gapi.auth2.getAuthInstance().isSignedIn.get());
       });
     }

     function handleClientLoad() {gapi.load('client:auth2', initClient);}
     function updateSignInStatus(isSignedIn) {
         makeApiCall();
     }
   </script>
   <script async defer src="https://apis.google.com/js/api.js" onload="this.onload=function(){};handleClientLoad()" onreadystatechange="if (this.readyState === 'complete') this.onload()"></script>

  </body>
</html>
