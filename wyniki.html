<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Tabelka LM 2019/2020</title>
    <link rel="stylesheet" href="./scss/style.min.css">
  </head>
  <body>
    <header>
      <nav>
        <ul>
          <li><a href="index.html">TABELKA</a></li>
          <li><a href="spiex.html">typowanie</a></li>
          <li><a href="#" class="selected">wyniki</a></li>
          <li><a href="punktacja.html">punktacja</a></li>
        </ul>
      </nav>
    </header>

    <div class="jumbo">
      <div class="foto-box">
        <img src="https://www.thesportsdb.com/images/media/league/badge/dtp1dl1534767233.png">
      </div>
      <div class="title-box">
        <div>
          <h1>Tabelka LM</h1>
          <p>wszystkie mecze</p>
        </div>
      </div>
    </div>

    <div class="pojemnik-wyniki" id="boksNaWyniki"></div>

    <footer>
      <p>copyright by śpiex, <script>document.write(new Date().getFullYear())</script></p>
      <p>marcin.spiewakowski@gmail.com</p>
    </footer>

    <script>
       function makeApiCall() {
         var params = {
           spreadsheetId: '1cK-0glAn4xyDOE1CQLhzy0Mx_8l0wFH-KW06rTKLg_E',
           range: "schedule",
         };

        // custom functions
        function print(message, location) {
          let div = document.querySelector(location);
          div.innerHTML = message;
        }

        function printPoints(array) {
          let wyniki = [];

          for (i=1; i < array.length; i++) {
            // console.log(array[i][0]);
            if (array[i][8] !== "") { // print only matches that ended
              wyniki +=
              `<div class="match-box">
                <p class="druzyna + ${array[i][6] === "A1" ? "handicap1" : array[i][6] === "A2" ? "handicap2" : ""}">${array[i][4]}</p>
                <div class="wynik-czas">
                  <div class="wynik">
                    <p>${array[i][7]}</p>
                    <p>:</p>
                    <p>${array[i][8]}</p>
                  </div>
                  <p class="czas">${array[i][2]}</p>
                </div>
                <p class="druzyna + ${array[i][6] === "B1" ? "handicap1" : array[i][6] === "B2" ? "handicap2" : ""}">${array[i][5]}</p>
                <div class="overlay hidden"></div>
              </div>`;
              wyniki += `<div class="hidden-content">`

              for (h=12; h < array[i].length; h+=4) {
                console.log(array[i][h]);
                  wyniki += `
                    <div class="hidden-row">
                      <div><p>hetman ★★</p></div>
                      <div>
                        <p>${array[i][h]}</p>
                        <p>:</p>
                        <p>${array[i][h+1]}</p>
                      </div>
                      <div>
                        <p>${array[i][h+2]}</p>
                        <p>${array[i][h+3] === "TRUE" ? "x2" : ""}</p>
                      </div>
                    </div>
                  `
              }

              wyniki += `</div>`; // end of hidden content
            } else
            print(wyniki,"#boksNaWyniki");
          }
        }

        var request = gapi.client.sheets.spreadsheets.values.get(params);
          request.then(function(response) {
            console.log(response.result);
            printPoints(response.result.values);
          }, function(reason) {
            console.error('error: ' + reason.result.error.message);
          });
       }


       function initClient() {
         var API_KEY = 'AIzaSyDteHMNEiCdA0XHbEPUM3plvjQzRw-rVVU';
         var CLIENT_ID = '896208609852-0d4hqobmliea0uq34uoho0lekhs2tch4.apps.googleusercontent.com';
         var SCOPE = 'https://www.googleapis.com/auth/spreadsheets.readonly';

         gapi.client.init({
           'apiKey': API_KEY,
           'clientId': CLIENT_ID,
           'scope': SCOPE,
           'discoveryDocs': ['https://sheets.googleapis.com/$discovery/rest?version=v4'],
         }).then(function() {
           gapi.auth2.getAuthInstance().isSignedIn.listen(updateSignInStatus);
           updateSignInStatus(gapi.auth2.getAuthInstance().isSignedIn.get());
         });
       }

       function handleClientLoad() {gapi.load('client:auth2', initClient);}
       function updateSignInStatus(isSignedIn) {
           makeApiCall();
       }
     </script>
     <script async defer src="https://apis.google.com/js/api.js" onload="this.onload=function(){};handleClientLoad()" onreadystatechange="if (this.readyState === 'complete') this.onload()"></script>

      <script src="script/wyniki.js"></script>

    </body>
  </html>
